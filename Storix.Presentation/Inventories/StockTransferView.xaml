<views:MvxWpfView x:Class="Storix.Presentation.Inventories.StockTransferView"
                  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                  xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
                  xmlns:inventories="clr-namespace:Storix.Core.ViewModels.Inventories;assembly=Storix.Core"
                  xmlns:loadingSpinnerControl="clr-namespace:LoadingSpinnerControl;assembly=LoadingSpinnerControl"
                  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                  xmlns:views="clr-namespace:MvvmCross.Platforms.Wpf.Views;assembly=MvvmCross.Platforms.Wpf"
                  d:DataContext="{d:DesignInstance Type=inventories:StockTransferViewModel,
                                                   IsDesignTimeCreatable=True}"
                  d:DesignHeight="auto"
                  d:DesignWidth="700"
                  mc:Ignorable="d">
    <Border Padding="30"
            Background="{DynamicResource PrimaryBackgroundColor}"
            BorderBrush="{DynamicResource SecondaryBorderColor}"
            BorderThickness="1"
            CornerRadius="12">
        <Grid>
            <!--  Loading Overlay  -->
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Visibility="{Binding IsLoading, Converter={StaticResource ToVisibilityConverter}}">
                <loadingSpinnerControl:LoadingSpinner Diameter="80"
                                                      IsLoading="{Binding IsLoading}"
                                                      Thickness="3" />
                <TextBlock Margin="0,10"
                           FontFamily="Californian FB"
                           FontSize="14"
                           Foreground="{DynamicResource SecondaryTextColor}"
                           Text="Processing transfer..."
                           TextAlignment="Center" />
            </StackPanel>

            <!--  Main Content  -->
            <Grid Visibility="{Binding IsLoading, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!--  Header Section  -->
                <Border Grid.Row="0"
                        Margin="0,0,0,20"
                        Padding="20"
                        Background="{DynamicResource CardBackgroundColor}"
                        BorderBrush="#06B6D4"
                        BorderThickness="2"
                        CornerRadius="12">
                    <StackPanel>
                        <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                            <iconPacks:PackIconMaterial Width="32"
                                                        Height="32"
                                                        Foreground="#06B6D4"
                                                        Kind="SwapHorizontal" />
                            <TextBlock Margin="12,0,0,0"
                                       VerticalAlignment="Center"
                                       FontFamily="Californian FB"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       Foreground="{DynamicResource PrimaryTextColor}"
                                       Text="Transfer Stock" />
                        </StackPanel>
                        <TextBlock Margin="0,8,0,0"
                                   HorizontalAlignment="Center"
                                   FontSize="13"
                                   Foreground="{DynamicResource SecondaryTextColor}"
                                   Text="Move inventory between locations"
                                   TextAlignment="Center" />
                    </StackPanel>
                </Border>

                <!--  Content  -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!--  Product Information Card  -->
                        <Border Padding="20"
                                Background="{DynamicResource CardBackgroundColor}"
                                BorderBrush="{DynamicResource SecondaryBorderColor}"
                                BorderThickness="1"
                                CornerRadius="8">
                            <StackPanel>
                                <TextBlock FontSize="18"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource PrimaryTextColor}"
                                           Text="{Binding ProductName}"
                                           TextWrapping="Wrap" />
                                <StackPanel Margin="0,8,0,0" Orientation="Horizontal">
                                    <Border Padding="8,4"
                                            Background="#DBEAFE"
                                            CornerRadius="6">
                                        <StackPanel Orientation="Horizontal">
                                            <iconPacks:PackIconMaterial Width="12"
                                                                        Height="12"
                                                                        VerticalAlignment="Center"
                                                                        Foreground="#1E40AF"
                                                                        Kind="TagOutline" />
                                            <TextBlock Margin="4,0,0,0"
                                                       FontFamily="Consolas"
                                                       FontSize="12"
                                                       FontWeight="Bold"
                                                       Foreground="#1E40AF"
                                                       Text="{Binding ProductSKU}" />
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!--  Transfer Locations  -->
                        <Border Margin="0,20,0,0"
                                Padding="20"
                                Background="{DynamicResource CardBackgroundColor}"
                                BorderBrush="{DynamicResource SecondaryBorderColor}"
                                BorderThickness="1"
                                CornerRadius="8">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="60" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <!--  From Location  -->
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Margin="0,0,0,8"
                                                   FontSize="13"
                                                   FontWeight="Bold"
                                                   Foreground="{DynamicResource PrimaryTextColor}"
                                                   Text="📤 FROM LOCATION" />
                                        <ComboBox Height="45"
                                                  Padding="15,0"
                                                  FontSize="14"
                                                  ItemsSource="{Binding AvailableFromLocations}"
                                                  SelectedItem="{Binding FromLocation, Mode=TwoWay}"
                                                  Style="{DynamicResource ComboBoxStyle}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <iconPacks:PackIconMaterial Width="16"
                                                                                    Height="16"
                                                                                    Margin="0,0,8,0"
                                                                                    VerticalAlignment="Center"
                                                                                    Foreground="#EF4444"
                                                                                    Kind="MapMarkerMinus" />
                                                        <TextBlock VerticalAlignment="Center" Text="{Binding LocationName}" />
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>

                                        <!--  From Location Stock  -->
                                        <Border Margin="0,10,0,0"
                                                Padding="12"
                                                Background="#FEE2E2"
                                                CornerRadius="6"
                                                Visibility="{Binding FromLocation, Converter={StaticResource NullToVisibilityConverter}}">
                                            <StackPanel>
                                                <TextBlock FontSize="10"
                                                           Foreground="#991B1B"
                                                           Text="CURRENT STOCK" />
                                                <TextBlock Margin="0,4,0,0"
                                                           FontSize="18"
                                                           FontWeight="Bold"
                                                           Foreground="#DC2626"
                                                           Text="{Binding FromLocationStock}" />
                                                <TextBlock Margin="0,2,0,0"
                                                           FontSize="10"
                                                           Foreground="#991B1B">
                                                    <Run Text="Available: " />
                                                    <Run FontWeight="Bold" Text="{Binding FromLocationAvailable, Mode=OneWay}" />
                                                </TextBlock>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>

                                    <!--  Arrow Icon  -->
                                    <iconPacks:PackIconMaterial Grid.Column="1"
                                                                Width="40"
                                                                Height="40"
                                                                Margin="10,30,10,0"
                                                                VerticalAlignment="Top"
                                                                Foreground="#06B6D4"
                                                                Kind="ArrowRight" />

                                    <!--  To Location  -->
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Margin="0,0,0,8"
                                                   FontSize="13"
                                                   FontWeight="Bold"
                                                   Foreground="{DynamicResource PrimaryTextColor}"
                                                   Text="📥 TO LOCATION" />
                                        <ComboBox Height="45"
                                                  Padding="15,0"
                                                  FontSize="14"
                                                  ItemsSource="{Binding AvailableToLocations}"
                                                  SelectedItem="{Binding ToLocation, Mode=TwoWay}"
                                                  Style="{DynamicResource ComboBoxStyle}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <iconPacks:PackIconMaterial Width="16"
                                                                                    Height="16"
                                                                                    Margin="0,0,8,0"
                                                                                    VerticalAlignment="Center"
                                                                                    Foreground="#10B981"
                                                                                    Kind="MapMarkerPlus" />
                                                        <TextBlock VerticalAlignment="Center" Text="{Binding LocationName}" />
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>

                                        <!--  To Location Stock  -->
                                        <Border Margin="0,10,0,0"
                                                Padding="12"
                                                Background="#D1FAE5"
                                                CornerRadius="6"
                                                Visibility="{Binding ToLocation, Converter={StaticResource NullToVisibilityConverter}}">
                                            <StackPanel>
                                                <TextBlock FontSize="10"
                                                           Foreground="#065F46"
                                                           Text="CURRENT STOCK" />
                                                <TextBlock Margin="0,4,0,0"
                                                           FontSize="18"
                                                           FontWeight="Bold"
                                                           Foreground="#10B981"
                                                           Text="{Binding ToLocationStock}" />
                                                <TextBlock Margin="0,2,0,0"
                                                           FontSize="10"
                                                           Foreground="#065F46">
                                                    <Run Text="After transfer: " />
                                                    <Run FontWeight="Bold" Text="{Binding ToLocationNewStock, Mode=OneWay}" />
                                                </TextBlock>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!--  Quantity Input  -->
                        <Border Margin="0,20,0,0"
                                Padding="20"
                                Background="{DynamicResource CardBackgroundColor}"
                                BorderBrush="{DynamicResource SecondaryBorderColor}"
                                BorderThickness="1"
                                CornerRadius="8">
                            <StackPanel>
                                <TextBlock Margin="0,0,0,10"
                                           FontSize="13"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource PrimaryTextColor}"
                                           Text="QUANTITY TO TRANSFER" />

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!--  Decrease Button  -->
                                    <Button Grid.Column="0"
                                            Width="55"
                                            Height="55"
                                            Command="{Binding DecreaseQuantityCommand}"
                                            Style="{DynamicResource CreateBtn}">
                                        <iconPacks:PackIconMaterial Width="24"
                                                                    Height="24"
                                                                    Kind="Minus" />
                                    </Button>

                                    <!--  Quantity TextBox  -->
                                    <TextBox Grid.Column="1"
                                             Height="50"
                                             Margin="10,0"
                                             Padding="0"
                                             HorizontalContentAlignment="Center"
                                             VerticalContentAlignment="Center"
                                             FontSize="24"
                                             FontWeight="Bold"
                                             Text="{Binding TransferQuantity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                    <!--  Increase Button  -->
                                    <Button Grid.Column="2"
                                            Width="55"
                                            Height="55"
                                            Command="{Binding IncreaseQuantityCommand}"
                                            Style="{DynamicResource CreateBtn}">
                                        <iconPacks:PackIconMaterial Width="24"
                                                                    Height="24"
                                                                    Kind="Plus" />
                                    </Button>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!--  Notes Input  -->
                        <Border Margin="0,20,0,0"
                                Padding="20"
                                Background="{DynamicResource CardBackgroundColor}"
                                BorderBrush="{DynamicResource SecondaryBorderColor}"
                                BorderThickness="1"
                                CornerRadius="8">
                            <StackPanel>
                                <TextBlock Margin="0,0,0,10"
                                           FontSize="13"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource PrimaryTextColor}"
                                           Text="TRANSFER NOTES (Optional)" />
                                <TextBox Height="80"
                                         Padding="12"
                                         AcceptsReturn="True"
                                         FontSize="13"
                                         Text="{Binding TransferNotes, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         TextWrapping="Wrap"
                                         VerticalScrollBarVisibility="Auto" />
                                <TextBlock Margin="0,6,0,0"
                                           FontSize="11"
                                           Foreground="{DynamicResource SecondaryTextColor}"
                                           Text="Provide context for this transfer (e.g., rebalancing stock, fulfilling order, etc.)" />
                            </StackPanel>
                        </Border>

                        <!--  Validation Message  -->
                        <Border Margin="0,15,0,0"
                                Padding="15"
                                Background="#FEE2E2"
                                BorderBrush="#EF4444"
                                BorderThickness="1"
                                CornerRadius="8"
                                Visibility="{Binding ValidationError, Converter={StaticResource NullToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal">
                                <iconPacks:PackIconMaterial Width="18"
                                                            Height="18"
                                                            VerticalAlignment="Center"
                                                            Foreground="#DC2626"
                                                            Kind="AlertCircle" />
                                <TextBlock Margin="10,0,0,0"
                                           VerticalAlignment="Center"
                                           FontSize="13"
                                           Foreground="#991B1B"
                                           Text="{Binding ValidationError}"
                                           TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!--  Footer Buttons  -->
                <Grid Grid.Row="2" Margin="0,25,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!--  Cancel Button  -->
                    <Button Grid.Column="1"
                            Width="130"
                            Height="42"
                            Margin="0,0,10,0"
                            Command="{Binding CancelCommand}"
                            Style="{DynamicResource CancelBtn}">
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconMaterial Width="18"
                                                        Height="18"
                                                        VerticalAlignment="Center"
                                                        Kind="Close" />
                            <TextBlock Margin="8,0,0,0"
                                       VerticalAlignment="Center"
                                       FontSize="14"
                                       Text="Cancel" />
                        </StackPanel>
                    </Button>

                    <!--  Transfer Button  -->
                    <Button Grid.Column="2"
                            Width="180"
                            Height="42"
                            Command="{Binding SaveTransferCommand}">
                        <Button.Style>
                            <Style BasedOn="{StaticResource CreateBtn}" TargetType="Button">
                                <Setter Property="Background" Value="#06B6D4" />
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#0891B2" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconMaterial Width="18"
                                                        Height="18"
                                                        VerticalAlignment="Center"
                                                        Kind="SwapHorizontal" />
                            <TextBlock Margin="8,0,0,0"
                                       VerticalAlignment="Center"
                                       FontSize="14"
                                       FontWeight="Bold"
                                       Text="Transfer Stock" />
                        </StackPanel>
                    </Button>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</views:MvxWpfView>