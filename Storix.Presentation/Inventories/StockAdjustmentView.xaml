<views:MvxWpfView x:Class="Storix.Presentation.Inventories.StockAdjustmentView"
                  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                  xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
                  xmlns:inventory="clr-namespace:Storix.Core.ViewModels.Inventories;assembly=Storix.Core"
                  xmlns:loadingSpinnerControl="clr-namespace:LoadingSpinnerControl;assembly=LoadingSpinnerControl"
                  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                  xmlns:views="clr-namespace:MvvmCross.Platforms.Wpf.Views;assembly=MvvmCross.Platforms.Wpf"
                  d:DataContext="{d:DesignInstance Type=inventory:StockAdjustmentViewModel,
                                                   IsDesignTimeCreatable=True}"
                  d:DesignHeight="auto"
                  d:DesignWidth="700"
                  mc:Ignorable="d">
    <Border Padding="30"
            Background="{DynamicResource PrimaryBackgroundColor}"
            BorderBrush="{DynamicResource SecondaryBorderColor}"
            BorderThickness="1"
            CornerRadius="12">
        <Grid>
            <!--  Loading Overlay  -->
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Visibility="{Binding IsLoading, Converter={StaticResource ToVisibilityConverter}, UpdateSourceTrigger=PropertyChanged}">
                <loadingSpinnerControl:LoadingSpinner Diameter="80"
                                                      IsLoading="{Binding IsLoading}"
                                                      Thickness="3" />
                <TextBlock Margin="0,10"
                           FontFamily="Californian FB"
                           FontSize="14"
                           Foreground="{DynamicResource SecondaryTextColor}"
                           Text="Processing adjustment..."
                           TextAlignment="Center" />
            </StackPanel>

            <!--  Main Content  -->
            <Grid Visibility="{Binding IsLoading, Converter={StaticResource InverseBooleanToVisibilityConverter}, ConverterParameter=true, UpdateSourceTrigger=PropertyChanged}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!--  Header Section  -->
                <Border Grid.Row="0"
                        Margin="0,0,0,20"
                        Padding="20"
                        Background="{DynamicResource CardBackgroundColor}"
                        BorderBrush="#3B82F6"
                        BorderThickness="2"
                        CornerRadius="12">
                    <StackPanel>
                        <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                            <iconPacks:PackIconMaterial Width="32"
                                                        Height="32"
                                                        Foreground="#3B82F6"
                                                        Kind="ChartBoxOutline" />
                            <TextBlock Margin="12,0,0,0"
                                       VerticalAlignment="Center"
                                       FontFamily="Californian FB"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       Foreground="{DynamicResource PrimaryTextColor}"
                                       Text="Adjust Stock Level" />
                        </StackPanel>
                        <TextBlock Margin="0,8,0,0"
                                   HorizontalAlignment="Center"
                                   FontSize="13"
                                   Foreground="{DynamicResource SecondaryTextColor}"
                                   Text="Modify inventory quantities for this product"
                                   TextAlignment="Center" />
                    </StackPanel>
                </Border>

                <!--  Content  -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!--  Product Information Card  -->
                        <Border Padding="20"
                                Background="{DynamicResource CardBackgroundColor}"
                                BorderBrush="{DynamicResource SecondaryBorderColor}"
                                BorderThickness="1"
                                CornerRadius="8">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!--  Product Name & SKU  -->
                                <StackPanel Grid.Row="0">
                                    <TextBlock FontSize="18"
                                               FontWeight="Bold"
                                               Foreground="{DynamicResource PrimaryTextColor}"
                                               Text="{Binding ProductName}"
                                               TextWrapping="Wrap" />
                                    <StackPanel Margin="0,8,0,0" Orientation="Horizontal">
                                        <Border Padding="8,4"
                                                Background="#DBEAFE"
                                                CornerRadius="6">
                                            <StackPanel Orientation="Horizontal">
                                                <iconPacks:PackIconMaterial Width="12"
                                                                            Height="12"
                                                                            VerticalAlignment="Center"
                                                                            Foreground="#1E40AF"
                                                                            Kind="TagOutline" />
                                                <TextBlock Margin="4,0,0,0"
                                                           FontFamily="Consolas"
                                                           FontSize="12"
                                                           FontWeight="Bold"
                                                           Foreground="#1E40AF"
                                                           Text="{Binding ProductSKU}" />
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </StackPanel>

                                <!--  Location Selector  -->
                                <StackPanel Grid.Row="1" Margin="0,20,0,0">
                                    <TextBlock Margin="0,0,0,8"
                                               FontSize="13"
                                               FontWeight="Bold"
                                               Foreground="{DynamicResource PrimaryTextColor}">
                                        <Run Text="📍" />
                                        <Run Text="SELECT LOCATION" />
                                    </TextBlock>
                                    <ComboBox Height="45"
                                              Padding="15,0"
                                              FontSize="14"
                                              ItemsSource="{Binding AvailableLocations}"
                                              SelectedItem="{Binding SelectedLocation, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <iconPacks:PackIconMaterial Width="16"
                                                                                Height="16"
                                                                                Margin="0,0,8,0"
                                                                                VerticalAlignment="Center"
                                                                                Foreground="#3B82F6"
                                                                                Kind="MapMarker" />
                                                    <TextBlock VerticalAlignment="Center" Text="{Binding LocationName}" />
                                                </StackPanel>
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>

                                <!--  Current Stock Display  -->
                                <Border Grid.Row="2"
                                        Margin="0,20,0,0"
                                        Padding="15"
                                        Background="#F1F5F9"
                                        CornerRadius="8"
                                        Visibility="{Binding SelectedLocation, Converter={StaticResource NullToVisibilityConverter}}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                            <TextBlock FontSize="11"
                                                       Foreground="{DynamicResource SecondaryTextColor}"
                                                       Text="CURRENT STOCK" />
                                            <TextBlock Margin="0,4,0,0"
                                                       FontSize="20"
                                                       FontWeight="Bold"
                                                       Foreground="#3B82F6"
                                                       Text="{Binding CurrentStock}" />
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Margin="10,0">
                                            <TextBlock FontSize="11"
                                                       Foreground="{DynamicResource SecondaryTextColor}"
                                                       Text="AVAILABLE" />
                                            <TextBlock Margin="0,4,0,0"
                                                       FontSize="20"
                                                       FontWeight="Bold"
                                                       Foreground="#10B981"
                                                       Text="{Binding AvailableStock}" />
                                        </StackPanel>

                                        <StackPanel Grid.Column="2" Margin="10,0,0,0">
                                            <TextBlock FontSize="11"
                                                       Foreground="{DynamicResource SecondaryTextColor}"
                                                       Text="RESERVED" />
                                            <TextBlock Margin="0,4,0,0"
                                                       FontSize="20"
                                                       FontWeight="Bold"
                                                       Foreground="#F59E0B"
                                                       Text="{Binding ReservedStock}" />
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </Grid>
                        </Border>

                        <!--  Adjustment Type Selection  -->
                        <Border Margin="0,20,0,0"
                                Padding="20"
                                Background="{DynamicResource CardBackgroundColor}"
                                BorderBrush="{DynamicResource SecondaryBorderColor}"
                                BorderThickness="1"
                                CornerRadius="8">
                            <StackPanel>
                                <TextBlock Margin="0,0,0,12"
                                           FontSize="14"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource PrimaryTextColor}"
                                           Text="ADJUSTMENT TYPE" />

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="10" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <!--  Increase Button  -->
                                    <RadioButton Grid.Column="0" IsChecked="{Binding IsIncrease, Mode=TwoWay}">
                                        <RadioButton.Template>
                                            <ControlTemplate TargetType="RadioButton">
                                                <Border Padding="20"
                                                        Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="2"
                                                        CornerRadius="8"
                                                        Cursor="Hand">
                                                    <StackPanel HorizontalAlignment="Center">
                                                        <iconPacks:PackIconMaterial Width="32"
                                                                                    Height="32"
                                                                                    HorizontalAlignment="Center"
                                                                                    Foreground="{TemplateBinding Foreground}"
                                                                                    Kind="PlusCircleOutline" />
                                                        <TextBlock Margin="0,8,0,0"
                                                                   HorizontalAlignment="Center"
                                                                   FontSize="15"
                                                                   FontWeight="Bold"
                                                                   Foreground="{TemplateBinding Foreground}"
                                                                   Text="Increase Stock" />
                                                        <TextBlock Margin="0,4,0,0"
                                                                   HorizontalAlignment="Center"
                                                                   FontSize="11"
                                                                   Foreground="{TemplateBinding Foreground}"
                                                                   Text="Add inventory" />
                                                    </StackPanel>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter Property="Background" Value="#D1FAE5" />
                                                        <Setter Property="BorderBrush" Value="#10B981" />
                                                        <Setter Property="Foreground" Value="#065F46" />
                                                    </Trigger>
                                                    <Trigger Property="IsChecked" Value="False">
                                                        <Setter Property="Background" Value="#F8FAFC" />
                                                        <Setter Property="BorderBrush" Value="#E2E8F0" />
                                                        <Setter Property="Foreground" Value="#64748B" />
                                                    </Trigger>
                                                    <MultiTrigger>
                                                        <MultiTrigger.Conditions>
                                                            <Condition Property="IsChecked" Value="False" />
                                                            <Condition Property="IsMouseOver" Value="True" />
                                                        </MultiTrigger.Conditions>
                                                        <Setter Property="BorderBrush" Value="#CBD5E1" />
                                                    </MultiTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </RadioButton.Template>
                                    </RadioButton>

                                    <!--  Decrease Button  -->
                                    <RadioButton Grid.Column="2" IsChecked="{Binding IsDecrease, Mode=TwoWay}">
                                        <RadioButton.Template>
                                            <ControlTemplate TargetType="RadioButton">
                                                <Border Padding="20"
                                                        Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="2"
                                                        CornerRadius="8"
                                                        Cursor="Hand">
                                                    <StackPanel HorizontalAlignment="Center">
                                                        <iconPacks:PackIconMaterial Width="32"
                                                                                    Height="32"
                                                                                    HorizontalAlignment="Center"
                                                                                    Foreground="{TemplateBinding Foreground}"
                                                                                    Kind="MinusCircleOutline" />
                                                        <TextBlock Margin="0,8,0,0"
                                                                   HorizontalAlignment="Center"
                                                                   FontSize="15"
                                                                   FontWeight="Bold"
                                                                   Foreground="{TemplateBinding Foreground}"
                                                                   Text="Decrease Stock" />
                                                        <TextBlock Margin="0,4,0,0"
                                                                   HorizontalAlignment="Center"
                                                                   FontSize="11"
                                                                   Foreground="{TemplateBinding Foreground}"
                                                                   Text="Remove inventory" />
                                                    </StackPanel>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter Property="Background" Value="#FEE2E2" />
                                                        <Setter Property="BorderBrush" Value="#EF4444" />
                                                        <Setter Property="Foreground" Value="#991B1B" />
                                                    </Trigger>
                                                    <Trigger Property="IsChecked" Value="False">
                                                        <Setter Property="Background" Value="#F8FAFC" />
                                                        <Setter Property="BorderBrush" Value="#E2E8F0" />
                                                        <Setter Property="Foreground" Value="#64748B" />
                                                    </Trigger>
                                                    <MultiTrigger>
                                                        <MultiTrigger.Conditions>
                                                            <Condition Property="IsChecked" Value="False" />
                                                            <Condition Property="IsMouseOver" Value="True" />
                                                        </MultiTrigger.Conditions>
                                                        <Setter Property="BorderBrush" Value="#CBD5E1" />
                                                    </MultiTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </RadioButton.Template>
                                    </RadioButton>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!--  Quantity Input  -->
                        <Border Margin="0,20,0,0"
                                Padding="20"
                                Background="{DynamicResource CardBackgroundColor}"
                                BorderBrush="{DynamicResource SecondaryBorderColor}"
                                BorderThickness="1"
                                CornerRadius="8">
                            <StackPanel>
                                <TextBlock Margin="0,0,0,10"
                                           FontSize="13"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource PrimaryTextColor}"
                                           Text="QUANTITY TO ADJUST" />

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!--  Decrease Button  -->
                                    <Button Grid.Column="0"
                                            Width="55"
                                            Height="55"
                                            Command="{Binding DecreaseQuantityCommand}"
                                            Style="{DynamicResource CreateBtn}">
                                        <iconPacks:PackIconMaterial Width="24"
                                                                    Height="24"
                                                                    Kind="Minus" />
                                    </Button>

                                    <!--  Quantity TextBox  -->
                                    <TextBox Grid.Column="1"
                                             Height="50"
                                             Margin="10,0"
                                             Padding="0"
                                             HorizontalContentAlignment="Center"
                                             VerticalContentAlignment="Center"
                                             FontSize="24"
                                             FontWeight="Bold"
                                             Text="{Binding AdjustmentQuantity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                    <!--  Increase Button  -->
                                    <Button Grid.Column="2"
                                            Width="55"
                                            Height="55"
                                            Command="{Binding IncreaseQuantityCommand}"
                                            Style="{DynamicResource CreateBtn}">
                                        <iconPacks:PackIconMaterial Width="24"
                                                                    Height="24"
                                                                    Kind="Plus" />
                                    </Button>
                                </Grid>

                                <!--  New Stock Preview  -->
                                <Border Margin="0,15,0,0"
                                        Padding="15"
                                        Background="#F1F5F9"
                                        CornerRadius="6"
                                        Visibility="{Binding SelectedLocation, Converter={StaticResource NullToVisibilityConverter}}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" HorizontalAlignment="Right">
                                            <TextBlock FontSize="11"
                                                       Foreground="{DynamicResource SecondaryTextColor}"
                                                       Text="CURRENT" />
                                            <TextBlock Margin="0,4,0,0"
                                                       FontSize="18"
                                                       FontWeight="Bold"
                                                       Foreground="{DynamicResource PrimaryTextColor}"
                                                       Text="{Binding CurrentStock}" />
                                        </StackPanel>

                                        <iconPacks:PackIconMaterial Grid.Column="1"
                                                                    Width="24"
                                                                    Height="24"
                                                                    Margin="15,10,15,0"
                                                                    VerticalAlignment="Center"
                                                                    Foreground="#64748B"
                                                                    Kind="ArrowRight" />

                                        <StackPanel Grid.Column="2" HorizontalAlignment="Left">
                                            <TextBlock FontSize="11"
                                                       Foreground="{DynamicResource SecondaryTextColor}"
                                                       Text="NEW STOCK" />
                                            <TextBlock Margin="0,4,0,0"
                                                       FontSize="18"
                                                       FontWeight="Bold">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Foreground" Value="#10B981" />
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsDecrease}" Value="True">
                                                                <Setter Property="Foreground" Value="#EF4444" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                                <Run Text="{Binding NewStockLevel, Mode=OneWay}" />
                                            </TextBlock>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </StackPanel>
                        </Border>

                        <!--  Reason Input  -->
                        <Border Margin="0,20,0,0"
                                Padding="20"
                                Background="{DynamicResource CardBackgroundColor}"
                                BorderBrush="{DynamicResource SecondaryBorderColor}"
                                BorderThickness="1"
                                CornerRadius="8">
                            <StackPanel>
                                <TextBlock Margin="0,0,0,10"
                                           FontSize="13"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource PrimaryTextColor}"
                                           Text="REASON FOR ADJUSTMENT (Optional)" />
                                <TextBox Height="80"
                                         Padding="12"
                                         AcceptsReturn="True"
                                         FontSize="13"
                                         Text="{Binding AdjustmentReason, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         TextWrapping="Wrap"
                                         VerticalScrollBarVisibility="Auto" />
                                <TextBlock Margin="0,6,0,0"
                                           FontSize="11"
                                           Foreground="{DynamicResource SecondaryTextColor}"
                                           Text="Provide context for this adjustment (e.g., damaged goods, inventory recount, etc.)" />
                            </StackPanel>
                        </Border>

                        <!--  Validation Message  -->
                        <Border Margin="0,15,0,0"
                                Padding="15"
                                Background="#FEE2E2"
                                BorderBrush="#EF4444"
                                BorderThickness="1"
                                CornerRadius="8"
                                Visibility="{Binding ValidationError, Converter={StaticResource NullToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal">
                                <iconPacks:PackIconMaterial Width="18"
                                                            Height="18"
                                                            VerticalAlignment="Center"
                                                            Foreground="#DC2626"
                                                            Kind="AlertCircle" />
                                <TextBlock Margin="10,0,0,0"
                                           VerticalAlignment="Center"
                                           FontSize="13"
                                           Foreground="#991B1B"
                                           Text="{Binding ValidationError}"
                                           TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!--  Footer Buttons  -->
                <Grid Grid.Row="2" Margin="0,25,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!--  Transfer Stock Button  -->
                    <Button Grid.Column="1"
                            Width="170"
                            Height="42"
                            Margin="0,0,10,0"
                            Command="{Binding TransferStockCommand}"
                            Style="{DynamicResource EditBtn}">
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconMaterial Width="18"
                                                        Height="18"
                                                        VerticalAlignment="Center"
                                                        Kind="PencilOutline" />
                            <TextBlock Margin="8,0,0,0"
                                       VerticalAlignment="Center"
                                       FontSize="14"
                                       Text="Transfer Stock" />
                        </StackPanel>
                    </Button>

                    <!--  Cancel Button  -->
                    <Button Grid.Column="2"
                            Width="130"
                            Height="42"
                            Margin="0,0,10,0"
                            Command="{Binding CancelCommand}"
                            Style="{DynamicResource CancelBtn}">
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconMaterial Width="18"
                                                        Height="18"
                                                        VerticalAlignment="Center"
                                                        Kind="Close" />
                            <TextBlock Margin="8,0,0,0"
                                       VerticalAlignment="Center"
                                       FontSize="14"
                                       Text="Cancel" />
                        </StackPanel>
                    </Button>

                    <!--  Save Button  -->
                    <Button Grid.Column="3"
                            Width="180"
                            Height="42"
                            Command="{Binding SaveAdjustmentCommand}"
                            Style="{DynamicResource CreateBtn}">
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconMaterial Width="18"
                                                        Height="18"
                                                        VerticalAlignment="Center"
                                                        Kind="ContentSaveOutline" />
                            <TextBlock Margin="8,0,0,0"
                                       VerticalAlignment="Center"
                                       FontSize="14"
                                       FontWeight="Bold"
                                       Text="Apply Adjustment" />
                        </StackPanel>
                    </Button>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</views:MvxWpfView>